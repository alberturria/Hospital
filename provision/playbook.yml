---
  - hosts: all

    tasks:
      - name: Actualizar paquetes del sistema
        become: yes
        apt:
          update_cache: yes

      - name: Instalar nodejs-legacy
        become: yes
        apt:
          name: nodejs-legacy
          state: present

      - name: Instalar npm (Gestor de paquetes de node)
        become: yes
        apt:
          name: npm
          state: present

      - name: Clonar el repositorio
        git: repo=https://github.com/alberturria/Hospital dest=/opt/Hospital/ clone=yes force=yes

      - name: Actualizar node a la ultima version
        command: npm install -g n latest
        become: yes

      - name: Establecer version estable
        command: n stable
        become: yes

      - name: Instalar las dependencias de la aplicación
        become: yes
        npm:
          path: /opt/Hospital/ 

      - name: Instalar forever para poder lanzar la aplicación sin límites.
        npm: name=forever global=yes state=present

